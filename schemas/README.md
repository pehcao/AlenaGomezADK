# Airtable Schema Documentation

This directory contains the JSON schema definitions for our Airtable integration. These schemas define the structure and validation rules for our CRM data tables.

## ğŸ“‹ Schema Files

- `schema_leads_table.json` - Lead management table structure (35 fields)
- `schema_calls_table.json` - Call tracking table structure (20 fields) 
- `complete_airtable_schema.json` - Combined schema for all tables

## ğŸ”§ Usage

These schemas are used by:
- **API Validation**: Ensuring data integrity in API requests
- **Code Generation**: Auto-generating Pydantic models
- **Documentation**: Understanding expected data structures
- **Testing**: Creating mock data for unit tests

## ğŸ“Š Lead Management Fields

Key fields in the leads table:
- **Identification**: `lead_phone_number`, `folio`, `name`
- **Location**: `alcaldia`, `direccion`, `referencias`
- **Tracking**: `num_llamadas`, `contactado`, `status`
- **Sales**: `venta`, `monto`, `comision`
- **Scheduling**: `fecha_cita`, `fecha_follow_up`

## ğŸ“ Call Tracking Fields

Key fields in the calls table:
- **Call Data**: `call_id`, `call_type`, `call_datetime`
- **Progress**: `last_completed_main_step_index`, `ingredients_agreement_status`
- **Content**: `transcript`, `objection_being_handled`
- **Follow-up**: `datetime_followup_call`, `follow_up_reason`

## ğŸ”„ Schema Updates

Schemas are automatically extracted from Airtable and should be updated when:
- New fields are added to tables
- Field types are modified
- Validation rules change

## ğŸ”’ Data Privacy

These schemas contain field definitions only - no actual customer data is stored in this repository.

## ğŸ” Schema Extraction Details

### Field Coverage
- **Leads Table**: 35/35 fields populated with data
- **Calls Table**: 18/20 fields populated (2 empty fields identified)

### Field Types Discovered
- `singleLineText` - Basic text fields
- `multilineText` - Long text areas  
- `number` - Numeric fields with precision settings
- `dateTime` - Date/time fields with timezone/format configuration
- `email` - Email address fields
- `phoneNumber` - Phone number fields
- Custom field types with specific business logic

### Empty Fields Identified
Fields present in schema but currently empty:
- **Calls Table**: 
  - `follow_up_reason`
  - `objection_being_handled`

## ğŸ› ï¸ Generated By

These schemas were extracted using `tests/test_table_schemas.py` which:
- Uses Airtable's Schema API to get complete field definitions
- Compares schema fields vs. fields with actual data
- Handles complex field options and configurations
- Exports JSON-serializable schema data

## ğŸ“Š Schema Statistics

| Table | Total Fields | Fields with Data | Empty Fields |
|-------|-------------|------------------|--------------|
| Leads | 35 | 35 | 0 |
| Calls | 20 | 18 | 2 |
| **Total** | **55** | **53** | **2** |

## ğŸ”„ Updating Schemas

To regenerate schemas after table structure changes:

```bash
cd tests
python test_table_schemas.py
```

This will update all schema files with the latest field definitions and data.

## ğŸ“ Schema Format

Each schema file contains:
```json
{
  "table_name": "Table Name",
  "table_id": "tblXXXXXXXXXXXXXX", 
  "total_fields": 35,
  "extracted_at": "2024-01-XX...",
  "fields": [
    {
      "id": "fldXXXXXXXXXXXXXX",
      "name": "field_name",
      "type": "singleLineText",
      "options": { ... }
    }
  ],
  "field_comparison": {
    "schema_fields": 35,
    "record_fields": 35, 
    "empty_fields": [],
    "unexpected_fields": []
  }
}
``` 